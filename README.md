## 1 пункт:
* фул пандас, excel. Для пояснений по коду см. комментарии
* в директории data лежат исходные файлы от балыкиной !!(файлы не менять, результаты вычилений туда не сохранять)!!
* в директории results лежат результаты вычислений.
* results/full_BD_isAlive.xlsx - файл с результатом первого пункта ( dataframe только с данными пациентов, у которых известен исход (жив/ мертв) ). В файле слиты данные из бд_моно и бд_бе_моно. Порядок и названия столбцов как в бд_без_моно.

## 2 пункт:
* results/<название вакцины на русском>.xlsx - файл по каждой вакцине (в том числе "Нет" - отсутствие вакцинации). Использовать в 3 пункте.
  
## 3 пункт:
* Формирование пар пациентов <br/>
    Для каждой группы и каждого пола (м и ж):<br/>
    1)Фильтруем по полу.<br/>
    2)Объединяем с F_data и D_data по CaseID.<br/>
    
* Создаём попарные сочетания пациентов с учётом:<br/>
  разницы возраста ≤ 3 лет,<br/>
  расхождения уровней F и D ≤ 10%,<br/>
  одинаковой степени тяжести и<br/>
  либо оба не вакцинированы, либо обеим введена одна и та же вакцина.<br/>

| Файл | Описание |
| --- | --- |
| results/pairs_SputnikV_м.csv | Пары мужчин, вакцина **SputnikV** |
| results/pairs_SputnikV_ж.csv | Пары женщин, вакцина **SputnikV** |
| results/pairs_SputnikLight_м.csv | Пары мужчин, вакцина **SputnikLight** |
| results/pairs_SputnikLight_ж.csv | Пары женщин, вакцина **SputnikLight** |
| results/pairs_EpiVacCorona_м.csv | Пары мужчин, вакцина **EpiVacCorona** |
| results/pairs_EpiVacCorona_ж.csv | Пары женщин, вакцина **EpiVacCorona** |
| results/pairs_KoviVac_м.csv | Пары мужчин, вакцина **KoviVac** |
| results/pairs_KoviVac_ж.csv | Пары женщин, вакцина **KoviVac** |
| results/pairs_Unvaccinated_м.csv | Пары мужчин **без вакцинации** |
| results/pairs_Unvaccinated_ж.csv | Пары женщин **без вакцинации** |

## 4 пункт:

| Вакцина | Пол | Всего пар (исходно) | Отобрано пар | p (возраст) | Нз (возраст) | p (ферритин) | Нз (ферритин) | p (D-димер) | Нз (D-димер) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| KoviVac | м | 406 | 14 | 0.0355 | ❌ | 0.9515 | ✅ | 0.9032 | ✅ |
| SputnikLight | ж | 1378 | 26 | 0.0014 | ❌ | 0.0559 | ✅ | 0.0247 | ❌ |
| EpiVacCorona | м | 171 | 9 | 0.0872 | ✅ | 0.1289 | ✅ | 0.1641 | ✅ |
| SputnikV | ж | 70876 | 188 | 0.0 | ❌ | 0.0 | ❌ | 0.0 | ❌ |
| Unvaccinated | м | 2043231 | 1011 | 0.0 | ❌ | 0.0 | ❌ | 0.0 | ❌ |
| SputnikV | м | 44253 | 149 | 0.0 | ❌ | 0.0 | ❌ | 0.0 | ❌ |
| Unvaccinated | ж | 3576320 | 713 | 0.0 | ❌ | 0.0 | ❌ | 0.0 | ❌ |
| KoviVac | ж | 703 | 19 | 0.0016 | ❌ | 0.3525 | ✅ | 0.001 | ❌ |
| EpiVacCorona | ж | 741 | 19 | 0.0003 | ❌ | 0.0546 | ✅ | 0.0361 | ❌ |
| SputnikLight | м | 1035 | 23 | 0.0018 | ❌ | 0.56 | ✅ | 0.0067 | ❌ |

#### Легенда таблицы:

| Столбец                 | Описание                                                                               |
| ----------------------- | -------------------------------------------------------------------------------------- |
| **Вакцина**             | Название вакцины или "Unvaccinated" — контрольная группа без вакцинации                |
| **Пол**                 | м = мужской, ж = женский                                                               |
| **Всего пар (исходно)** | Общее количество пар "вакцинированный–невакцинированный" после фильтрации, до отбора   |
| **Отобрано пар**        | Количество пар, реально включённых в анализ после matching по основным параметрам      |
| **p (возраст)**         | p-значение критерия (обычно Mann–Whitney или t-test) для сравнения возраста в группах  |
| **Нз (возраст)**        | Нулевая значимость: **False** = статистически значимо (p < 0.05), **True** = незначимо |
| **p (ферритин)**        | То же самое — сравнение уровня ферритина                                               |
| **Нз (ферритин)**       | Флаг значимости по ферритину                                                           |
| **p (D-димер)**         | То же — сравнение уровня D-димера                                                      |
| **Нз (D-димер)**        | Флаг значимости по D-димеру                                                            |


#### Объяснение столбцов:
* Всего пар (исходно) – общее число уникальных непересекающихся пар после удаления самопар и дубликатов.
* Отобрано пар – число пар, оставшихся после one-to-one matching (каждый пациент участвует только в одной паре).
* p (возраст) – [p-value](https://en.wikipedia.org/wiki/P-value) парного [t-теста](https://en.wikipedia.org/wiki/Student%27s_t-test) для сравнения возрастов участников пары.
* Нз (возраст) – ✅ если возрастные различия не значимы, ❌ если значимы.
* Нз (ферритин) – ✅ если различия по ферритину не значимы, ❌ если значимы.
* p (D-димер) – p-value [Wilcoxon-теста](https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test) для D-димера.
* Нз (D-димер) – ✅ если различия по D-димеру не значимы, ❌ если значимы.
  ###### p = 0.0 означает, что p-value чрезвычайно мало (например, < 2.2e-16) и округлено до нуля. Это говорит о высокой статистической значимости различий между группами.

### Выводы и интерпретация:

##### Контрольные группы (Unvaccinated):
  * У обоих полов все различия статистически значимы (p = 0.0). (т.к. cамая большая группа)
    
##### KoviVac:
  * Мужчины: Значимые различия по возрасту, ферритин и D-димер — выровнены (не различаются);

  * Женщины: Значимые различия по возрасту и D-димеру, ферритин — выровнен.

##### SputnikLight:
  * Женщины: Все параметры различаются статистически значимо (наименее выражено по D-димеру: p = 0.0247);
  * Мужчины: Отличия по возрасту и D-димеру; ферритин — незначим.

##### EpiVacCorona:
  * Мужчины: Все три переменные сбалансированы (p > 0.05);
  * Женщины: Значимые различия по возрасту и D-димеру; ферритин на границе значимости.
    
##### SputnikV:
  * И мужчины, и женщины: Все сравнения показывают значимые различия (p = 0.0). Это говорит о сильной несбалансированности групп даже после matching, в отличие от других вакцин.


### Анализ пунктов 5 и 6: Сравнение исходов и влияние факторово(`analyze_point_5_6.py`)

## Подготовка данных для анализа

1.  **Сбор данных из файлов пар:**
    *   Скрипт ищет CSV-файлы, соответствующие шаблону `result/pairs_*.csv`. Эти файлы генерируются предыдщуим скриптом `three.py` и содержат пара пациентов, подобранных по определенным критериям(возраст, пол, вакцина, степень тяжести, уровни D-димера и ферритина)
    *   Из каждой строки (пары) в этих файлах извлекаются данные обоих пациентов. Функция `get_therapy_group_from_string` определяет, к какой группе ("Intervention" или "Control") относится каждый пациент на основе описания терапии в столбцах `Ther` и `Ther_right` (ищет наличие "с ЛП" или "без ЛП")
    *   В анализ включаются только те пары, где один пациент относится к группе "Intervention", а другой - к "Control". Данные этих пациентов добавляются в список `all_patient_records`
2.  **Объединение с мастер-файлом:**
    *   Создается DataFrame `df_from_pairs` из списка `all_patient_records`. Удаляются возможные дубликаты пациентов(если один и тот же пациент попал в несколько пар в одной и той же роли)
    *   Этот DataFrame объединяется с основным файлом данные `results/full_BD_isAlive.xlsx`(переменная `master_df`) по `caseID`. Из `master_df` извлекаются важные данные: `Start` (дата начало госпитализации), `End` (дата окончания) и `Outcome` (исход: "Выписан" или "Умер")
3.  **Предобработка в `preprocess_data`:**
    *   **Длительность госпитализации (`Hospitalization_Duration`):** Расчитывается как разница в днях между `End` и `Start`
    *   **Бинарный исход (`Outcome_Binary`):** Создается числовая колонка, где "УмерЭ кодируется как 1, а "Выписан" - 0
    *   Итоговый DataFrame `paired_df_processed` передается в функции анализа
 
**Цель скрпита:**
1. Сравнить исходы(выживаемость, длительность госпитализации) между двумя сопостовимыми группами пациентов
2. Оценить влияние отдельных клинико-демографических факторов на общие исходы заболевания для всех пациентов в исследуемой выборке

##  Пункт 5: Сравнение групп по исходам

### 5a: Исход (жив/умер) по группам терапии

*   **Цель:** Сравнить долю выживших и умерших пациентов между группами "Intervention" и "Control".
*   **Методы:**
    *   Расчет абсолютных количеств и процентного соотношения исходов в каждой группе (`pd.crosstab`).
    *   **Визуализация:** Столбчатая диаграмма, показывающая процентное соотношение исходов ("Выписан", "Умер") для каждой терапевтической группы.
    *   **Статистический тест:** Тест хи-квадрат для проверки статистической значимости различий в распределении исходов.
*   **Результаты:**
    *   **График:** Визуально показал 100% выживаемость в группе "Intervention" (5 из 5 пациентов выписаны) и ~94% выживаемость в группе "Control" (717 выписаны, 45 умерли из 762).
    *   **Тест хи-квадрат:** p-value = 1.000. Вывод: "Статистически значимой разницы в исходах между группами терапии не обнаружено."
*   **Проблемы и интерпретация:** Основная проблема – крайне малый размер группы "Intervention" (n=5). Отсутствие смертей в такой маленькой группе не позволяет сделать выводов об эффективности терапии.

### 5b: Длительность госпитализации для выживших по группам терапии

*   **Цель:** Сравнить длительность пребывания в стационаре для пациентов, которые были выписаны, между группами "Intervention" и "Control".
*   **Методы:**
    *   Фильтрация данных: отбираются только выжившие пациенты (`Outcome == 'Выписан'`).
    *   Расчет описательных статистик (среднее, медиана, стандартное отклонение, количество) для длительности госпитализации в каждой группе.
    *   **Визуализация:** Точечная диаграмма (`stripplot`), где каждая точка представляет одного пациента. Точки сгруппированы по терапевтической группе и окрашены в разные цвета. Горизонтальные пунктирные линии показывают медианную длительность госпитализации для каждой группы. На оси X указано количество пациентов в каждой группе (n).
    *   **Статистический тест:** U-критерий Манна-Уитни для сравнения распределений длительности госпитализации между двумя независимыми группами.
*   **Результаты:**
    *   **Сводка:**
        *   Control (n=717): среднее ~10.6 дней, медиана 9 дней.
        *   Intervention (n=5): среднее ~10.4 дней, медиана 11 дней.
    *   **График:** Наглядно показал все 5 точек для группы "Intervention" и их расположение относительно медианы. Для группы "Control" видно более широкое распределение точек. Медианные значения для обеих групп визуально близки.
    *   **U-критерий Манна-Уитни:** p-value = 0.633. Вывод: "Статистически значимой разницы в длительности госпитализации не обнаружено."
*   **Проблемы и интерпретация:** Как и в пункте 5a, малый размер группы "Intervention" (n=5 выживших) сильно ограничивает выводы. Точечная диаграмма полезна для визуализации индивидуальных данных малой группы, но статистический тест также имеет низкую мощность.

## Есть проблема: Дисбаланс размеров групп
*   Я проверил файл и там реальный дисбаланс, ниже я написал насколько. 

*   **Обнаружение:** Итоговый DataFrame для анализа (`current_df_to_analyze`) содержал:
    *   Группа "Control": 762 пациента
    *   Группа "Intervention": 5 пациентов
*   **Поиск причины:** Для выяснения причин я использовал вспомогательный скрипт `check_ther.py`, который проанализировал столбец `Ther` в исходном файле `results/full_BD_isAlive.xlsx`.
    *   **Результат `check_ther.py`:**
        *   Пациентов "с ЛП" (потенциальная группа "Intervention"): **66**
        *   Пациентов "без ЛП" (потенциальная группа "Control"): **12240**
*   **То есть:** В исходной базе данных (`full_BD_isAlive.xlsx`) изначально присутствует очень малое количество пациентов (всего 66), где содержит маркер "с ЛП".

#### Пункт 5: Сравнение полученных групп ("Intervention" vs "Control") по исходам

Этот раздел посвящен сравнению двух терапевтических групп: группы вмешательства ("Intervention", пациенты, получавшие ЛП) и контрольной группы ("Control", пациенты без ЛП).

##### 5а: Исход (жив/умер) по группам терапии

*   **Функция в скрипте:** `analyze_point_5()`
*   **Тип графика:** Столбчатая диаграмма (Bar chart).
*   **Что показывает:**
    *   На оси X отложены две терапевтические группы: "Intervention" и "Control".
    *   На оси Y отображается процент пациентов.
    *   Для каждой группы присутствуют два столбца (или один разделенный столбец), показывающие процентное соотношение пациентов с исходом 'Выписан' и 'Умер'.
*   **Цель:** Визуально сравнить показатели выживаемости/смертности между двумя терапевтическими группами. Позволяет оценить, есть ли видимые различия в долях пациентов с разными исходами в зависимости от примененной терапии.
*   **Статистический тест:** Сопровождается тестом хи-квадрат, который оценивает, являются ли наблюдаемые различия в распределении исходов статистически значимыми.

##### 5b: Длительность госпитализации для выживших по группам терапии

*   **Функция в скрипте:** `analyze_point_5()`
*   **Тип графика:** Точечная диаграмма (Strip plot) с наложением линий медиан.
*   **Что показывает:**
    *   Анализируются только пациенты с исходом 'Выписан'.
    *   На оси X отложены две терапевтические группы: "Intervention" и "Control". К меткам групп добавлено количество пациентов (n) в каждой группе выживших.
    *   На оси Y отложена длительность госпитализации в днях.
    *   Каждая точка на графике представляет одного выжившего пациента, её положение по оси Y соответствует длительности его госпитализации. Точки для разных групп могут быть окрашены в разные цвета для наглядности.
    *   Горизонтальные пунктирные линии показывают медианную длительность госпитализации для каждой из терапевтических групп.
*   **Цель:** Сравнить, отличалась ли длительность пребывания в больнице у *выживших* пациентов в зависимости от полученной терапии. График позволяет увидеть не только центральные тенденции (медианы), но и разброс индивидуальных значений длительности госпитализации в каждой группе.
*   **Статистический тест:** Сопровождается U-критерием Манна-Уитни, который сравнивает распределения длительности госпитализации между двумя независимыми группами.

#### Пункт 6: Оценка влияния отдельных факторов на исходы и длительность госпитализации (для всех пациентов из `paired_df_processed`)

Этот раздел анализирует, как различные факторы (возраст, пол, вакцинация, тяжесть заболевания, уровни D-димера и ферритина) связаны с общими исходами заболевания и длительностью госпитализации для выживших.

##### 6.1 Влияние факторов на ИСХОД (Умер/Выписан)

**1. График "Распределение 'Возраст' по исходам"**

*   **Где в скрипте:** Генерируется функцией `analyze_numeric_vs_outcome(df, numeric_col, col_name_rus)` при вызове с `numeric_col='Age'`.
*   **Тип графика:** Скрипичная диаграмма (Violin plot) с отображением квартилей (`inner="quartile"`).
*   **Что изображено:**
    *   **Ось X (Исход):** Две категории – "Выписан (0)" (синяя скрипка слева) и "Умер (1)" (оранжевая скрипка справа).
    *   **Ось Y (Возраст):** Возраст пациентов.
    *   **Синяя скрипка ("Выписан (0)"):**
        *   **Форма:** Показывает распределение возраста среди выписанных пациентов. Видно, что основная масса выписанных пациентов имеет возраст примерно от 50 до 80 лет, с пиком плотности где-то в районе 60-70 лет. Распределение довольно симметричное, хотя и сужается к более молодым и более пожилым возрастам.
        *   **Внутренние линии (квартили):**
            *   Средняя пунктирная линия: Медианный возраст выписанных пациентов (около 65-68 лет).
            *   Верхняя и нижняя пунктирные линии: 75-й и 25-й процентили соответственно (примерно 50-53 года и 75-78 лет). Это интерквартильный размах.
    *   **Оранжевая скрипка ("Умер (1)"):**
        *   **Форма:** Показывает распределение возраста среди умерших пациентов. Эта скрипка заметно смещена вверх по оси Y по сравнению с синей. Основная масса умерших пациентов старше, с пиком плотности в районе 75-85 лет.
        *   **Внутренние линии (квартили):**
            *   Средняя пунктирная линия: Медианный возраст умерших пациентов (около 78-80 лет).
            *   Верхняя и нижняя пунктирные линии: 75-й и 25-й процентили (примерно 68-70 лет и 85-88 лет).
*   **Цель и интерпретация:**
    *   Сравнить возрастные распределения между выжившими и умершими пациентами.
    *   **Наблюдение:** График наглядно показывает, что группа умерших пациентов в целом была старше группы выписанных. Медианный возраст умерших выше, и вся "скрипка" для умерших смещена в сторону более старших возрастов. Это предполагает, что возраст является фактором риска неблагоприятного исхода.
    *   Статистический тест (U-критерий Манна-Уитни, который вызывается в этой функции) должен показать, является ли это различие в распределениях статистически значимым.

**2. График "Процент умерших по категориям 'Пол'"**

*   **Где в скрипте:** Генерируется функцией `analyze_categorical_vs_outcome(df, cat_col, col_name_rus)` при вызове с `cat_col='Gender'`.
*   **Тип графика:** Столбчатая диаграмма (Bar chart).
*   **Что изображено:**
    *   **Ось X (Пол):** Две категории – "ж" (женщины) и "м" (мужчины).
    *   **Ось Y (Процент умерших (%)):** Доля умерших пациентов в каждой категории пола.
    *   **Столбцы:**
        *   Для "ж": Высота столбца показывает процент умерших среди женщин (около 5.6%).
        *   Для "м": Высота столбца показывает процент умерших среди мужчин (около 6.4%).
*   **Цель и интерпретация:**
    *   Визуально оценить, есть ли разница в проценте летальных исходов между мужчинами и женщинами.
    *   **Наблюдение:** На графике видно, что процент умерших среди мужчин немного выше, чем среди женщин. Однако разница не выглядит очень большой.
    *   Статистический тест (хи-квадрат, который вызывается в этой функции) поможет определить, является ли это небольшое наблюдаемое различие статистически значимым или оно могло возникнуть случайно.

**3. График "Процент умерших по категориям 'Статус вакцинации'"**

*   **Где в скрипте:** Генерируется функцией `analyze_categorical_vs_outcome(df, cat_col, col_name_rus)` при вызове с `cat_col='Vac'`.
*   **Тип графика:** Столбчатая диаграмма (Bar chart).
*   **Что изображено:**
    *   **Ось X (Статус вакцинации):** Категории вакцин, которые присутствовали в данных ("EpiVacCorona", "SputnikLight", "SputnikV")
    *   **Ось Y (Процент умерших (%)):** Доля умерших пациентов в каждой категории статуса вакцинации.
    *   **Столбцы:** Высота каждого столбца соответствует проценту умерших пациентов, имевших данный статус вакцинации.
        *   "EpiVacCorona": около 5.1% умерших.
        *   "SputnikLight": около 3.8% умерших.
        *   "SputnikV": около 6.1% умерших.
*   **Цель и интерпретация:**
    *   Визуально сравнить процент летальных исходов среди пациентов с разным статусом вакцинации.
    *   **Наблюдение:** На данном срезе графика видно, что самый низкий процент умерших наблюдается у "SputnikLight", а самый высокий – у "SputnikV". "EpiVacCorona" где-то посередине.
    *   **Важно:** Для полной интерпретации нужно видеть все категории вакцин (включая невакцинированных, если они есть в анализе) и знать количество пациентов (n) в каждой категории. Если в какой-то категории очень мало пациентов, то процент смертности может быть нестабильным и нерепрезентативным.
    *   Статистический тест (хи-квадрат) оценит, есть ли статистически значимые различия в проценте умерших между всеми представленными группами вакцинации.

**4. График "Распределение 'D-димер' по исходам"**

*   **Где в скрипте:** Генерируется функцией `analyze_numeric_vs_outcome(df, numeric_col, col_name_rus)` при вызове с `numeric_col='D-dimer'`.
*   **Тип графика:** Скрипичная диаграмма (Violin plot) с отображением квартилей (`inner="quartile"`).
*   **Что изображено:**
    *   **Ось X (Исход):** Две категории – "Выписан (0)" (синяя скрипка слева) и "Умер (1)" (оранжевая скрипка справа).
    *   **Ось Y (D-димер):** Уровень D-димера.
    *   **Синяя скрипка ("Выписан (0)"):**
        *   *Форма:* Показывает распределение D-димера среди выписанных пациентов. Большинство значений сконцентрировано в нижней части, с длинным "хвостом" вверх, указывающим на наличие пациентов с высокими значениями D-димера, но в целом основная масса имеет низкие или умеренные уровни.
        *   *Внутренние линии (квартили):* Показывают медиану и интерквартильный размах D-димера для выписанных. Медиана, вероятно, находится на относительно низком уровне.
    *   **Оранжевая скрипка ("Умер (1)"):**
        *   *Форма:* Распределение D-димера среди умерших пациентов. Эта скрипка заметно шире и смещена вверх по сравнению с синей, особенно в области более высоких значений. Это указывает на то, что у умерших пациентов чаще встречались высокие уровни D-димера. Форма может быть мультимодальной (несколько "горбов"), что говорит о неоднородности группы.
        *   *Внутренние линии (квартили):* Медиана и интерквартильный размах для умерших, вероятно, будут выше, чем у выписанных.
*   **Цель и интерпретация:**
    *   Сравнить распределения уровней D-димера между выжившими и умершими пациентами.
    *   **Наблюдение:** График показывает, что у умерших пациентов уровни D-димера были в целом выше и имели больший разброс по сравнению с выписанными. Это может указывать на то, что повышенный D-димер ассоциирован с неблагоприятным исходом.
    *   Статистический тест (U-критерий Манна-Уитни) оценит значимость этого различия.

**5. График "Распределение 'Ферритин' по исходам"**

*   **Где в скрипте:** Генерируется функцией `analyze_numeric_vs_outcome(df, numeric_col, col_name_rus)` при вызове с `numeric_col='Ferritin'`.
*   **Тип графика:** Скрипичная диаграмма (Violin plot) с отображением квартилей (`inner="quartile"`).
*   **Что изображено:**
    *   **Ось X (Исход):** "Выписан (0)" (синяя скрипка) и "Умер (1)" (оранжевая скрипка).
    *   **Ось Y (Ферритин):** Уровень ферритина.
    *   **Синяя скрипка ("Выписан (0)"):**
        *   *Форма:* Распределение ферритина у выписанных. Как и у D-димера, большинство значений, вероятно, сконцентрировано внизу, с возможным длинным хвостом высоких значений.
        *   *Внутренние линии (квартили):* Медиана и интерквартильный размах для выписанных.
    *   **Оранжевая скрипка ("Умер (1)"):**
        *   *Форма:* Распределение ферритина у умерших. Скрипка также смещена вверх и, возможно, шире, указывая на более высокие уровни ферритина у умерших пациентов.
        *   *Внутренние линии (квартили):* Медиана и интерквартильный размах для умерших.
*   **Цель и интерпретация:**
    *   Сравнить распределения уровней ферритина между выжившими и умершими.
    *   **Наблюдение:** Аналогично D-димеру, график предполагает, что у умерших пациентов уровни ферритина были выше, чем у выписанных. Это может свидетельствовать о связи повышенного ферритина с риском летального исхода.
    *   Статистический тест (U-критерий Манна-Уитни) поможет подтвердить это наблюдение.

**6. График "Процент умерших по категориям 'Степень тяжести'"**

*   **Где в скрипте:** Генерируется функцией `analyze_categorical_vs_outcome(df, cat_col, col_name_rus)` при вызове с `cat_col='Severity_Score_Simplified'` (или аналогичным названием колонки, представляющей упрощенную степень тяжести).
*   **Тип графика:** Столбчатая диаграмма (Bar chart).
*   **Что изображено:**
    *   **Ось X (Степень тяжести):** Категории степени тяжести ("high" и "medium").
    *   **Ось Y (Процент умерших (%)):** Доля умерших пациентов в каждой категории степени тяжести.
    *   **Столбцы:**
        *   Для "high": Высота столбца показывает процент умерших среди пациентов с высокой степенью тяжести (около 68-69%).
        *   Для "medium": Высота столбца показывает процент умерших среди пациентов со средней степенью тяжести (очень низкий, около 1-2%).
*   **Цель и интерпретация:**
    *   Визуально оценить, как степень тяжести заболевания связана с риском летального исхода.
    *   **Наблюдение:** График очень наглядно демонстрирует сильную связь: процент умерших значительно выше в группе с высокой степенью тяжести по сравнению с группой со средней степенью тяжести. Это ожидаемый результат, подтверждающий, что исходная тяжесть состояния является критическим фактором прогноза.
    *   Статистический тест (хи-квадрат) должен показать высокую статистическую значимость этого различия.


##### 6.2 Влияние факторов на ДЛИТЕЛЬНОСТЬ ГОСПИТАЛИЗАЦИИ (для выживших)

**1. График "'Возраст' vs Длительность госпитализации"**

*   **Где в скрипте:** Генерируется функцией `analyze_numeric_vs_duration(df_analysis_survived, 'Age', 'Возраст')`.
*   **Тип графика:** Диаграмма рассеяния (Scatter plot).
*   **Что изображено:**
    *   **Ось X (Возраст):** Возраст выживших пациентов.
    *   **Ось Y (Длительность госпитализации (дни)):** Длительность пребывания в стационаре для выживших пациентов.
    *   **Точки:** Каждая синяя точка представляет одного выжившего пациента. Её положение на графике определяется возрастом пациента (по оси X) и длительностью его госпитализации (по оси Y).
*   **Цель и интерпретация:**
    *   Визуально оценить, есть ли какая-либо связь (корреляция) между возрастом выживших пациентов и длительностью их госпитализации.
    *   **Наблюдение:** На графике видно большое количество точек, распределенных по всей области. Кажется, что есть некоторая тенденция к увеличению длительности госпитализации с возрастом, особенно для пациентов старше ~50-60 лет – облако точек как будто немного поднимается вправо-вверх. Однако разброс значений длительности госпитализации довольно велик для всех возрастов. Нет четкой линейной зависимости, но и полного отсутствия связи тоже не скажешь.
    *   Статистический тест (коэффициент корреляции Спирмена, который рассчитывается в функции `analyze_numeric_vs_duration`) поможет количественно оценить силу и направление этой связи, а также её статистическую значимость.

**2. График "Длительность госпитализации по категориям 'Пол'"**

*   **Где в скрипте:** Генерируется функцией `analyze_categorical_vs_duration(df_analysis_survived, 'Gender', 'Пол')`.
*   **Тип графика:** Скрипичная диаграмма (Violin plot) с отображением квартилей (`inner="quartile"`).
*   **Что изображено:**
    *   **Ось X (Пол):** Две категории – "ж" (женщины, синяя скрипка) и "м" (мужчины, зеленая скрипка).
    *   **Ось Y (Длительность госпитализации (дни)):** Длительность пребывания в стационаре для выживших пациентов.
    *   **Синяя скрипка ("ж"):**
        *   *Форма:* Показывает распределение длительности госпитализации среди выживших женщин. Основная масса значений сконцентрирована в нижней части (примерно до 15-20 дней), с длинным "хвостом" вверх, указывающим на наличие женщин с более длительной госпитализацией.
        *   *Внутренние линии (квартили):* Показывают медиану (около 8-9 дней) и интерквартильный размах для женщин.
    *   **Зеленая скрипка ("м"):**
        *   *Форма:* Показывает распределение длительности госпитализации среди выживших мужчин. Форма похожа на женскую, также с концентрацией внизу и хвостом вверх. Визуально кажется, что медиана и распределение в целом очень схожи с женской группой.
        *   *Внутренние линии (квартили):* Показывают медиану (также около 8-10 дней) и интерквартильный размах для мужчин.
*   **Цель и интерпретация:**
    *   Сравнить распределения длительности госпитализации между выжившими мужчинами и женщинами.
    *   **Наблюдение:** Визуально скрипки для мужчин и женщин очень похожи по форме, медианам и разбросу. Это предполагает, что существенной разницы в длительности госпитализации между полами среди выживших пациентов нет.
    *   Статистический тест (U-критерий Манна-Уитни, который вызывается в этой функции для двух категорий) оценит, является ли это визуальное сходство статистически значимым (т.е. отсутствие значимой разницы).

**3. График "Длительность госпитализации по категориям 'Статус вакцинации'"**

*   **Где в скрипте:** Генерируется функцией `analyze_categorical_vs_duration(df_analysis_survived, 'Vac', 'Статус вакцинации')`.
*   **Тип графика:** Скрипичная диаграмма (Violin plot) с отображением квартилей (`inner="quartile"`).
*   **Что изображено:**
    *   **Ось X (Статус вакцинации):** Категории вакцин ("EpiVacCorona", "SputnikLight", "SputnikV").
    *   **Ось Y (Длительность госпитализации (дни)):** Длительность пребывания в стационаре для выживших пациентов.
    *   **Скрипки для каждой вакцины:**
        *   *Форма:* Каждая скрипка показывает распределение длительности госпитализации для выживших пациентов, имевших соответствующий статус вакцинации. Все три скрипки на изображении имеют схожую форму: основная масса значений внизу (до ~20 дней) и длинные хвосты вверх, указывающие на отдельных пациентов с более длительной госпитализацией.
        *   *Внутренние линии (квартили):* Показывают медианы и интерквартильные размахи для каждой группы.
            *   "EpiVacCorona" (темно-синяя): медиана около 10 дней.
            *   "SputnikLight" (зеленоватая): медиана около 12-13 дней.
            *   "SputnikV" (светло-зеленая): медиана около 9-10 дней.
*   **Цель и интерпретация:**
    *   Сравнить распределения длительности госпитализации у выживших пациентов с разным статусом вакцинации.
    *   **Наблюдение:** Медианные значения длительности госпитализации визуально несколько различаются между группами ("SputnikLight" кажется имеет чуть более высокую медиану), но формы скрипок и их общий разброс достаточно схожи. "Хвосты" у "SputnikLight" и "SputnikV" кажутся длиннее, указывая на наличие случаев очень длительной госпитализации в этих группах.
    *   Статистический тест (тест Краскела-Уоллиса, который вызывается в этой функции для более чем двух категорий) оценит, есть ли статистически значимые различия в распределениях длительности госпитализации между всеми представленными группами вакцинации.

**4. График "Длительность госпитализации по категориям 'Степень тяжести'"**

*   **Где в скрипте:** Генерируется функцией `analyze_categorical_vs_duration(df_analysis_survived, 'Severity_Score_Simplified', 'Степень тяжести')`.
*   **Тип графика:** Скрипичная диаграмма (Violin plot) с отображением квартилей (`inner="quartile"`).
*   **Что изображено:**
    *   **Ось X (Степень тяжести):** Категории степени тяжести ("high" - темно-синяя скрипка, и "medium" - зеленая скрипка).
    *   **Ось Y (Длительность госпитализации (дни)):** Длительность пребывания в стационаре для выживших пациентов.
    *   **Скрипки для каждой степени тяжести:**
        *   *Форма ("high"):* Показывает распределение длительности госпитализации у выживших пациентов с высокой степенью тяжести. Скрипка шире, особенно в области более длительных сроков (например, 10-25 дней).
        *   *Форма ("medium"):* Показывает распределение для средней степени тяжести. Скрипка более узкая и смещена вниз, указывая на в целом более короткие сроки госпитализации. "Хвост" вверх короче.
        *   *Внутренние линии (квартили):* Медиана для группы "high" (около 15-17 дней) заметно выше, чем для группы "medium" (около 8-10 дней).
*   **Цель и интерпретация:**
    *   Сравнить распределения длительности госпитализации у выживших пациентов с разной исходной степенью тяжести.
    *   **Наблюдение:** График наглядно показывает, что выжившие пациенты, у которых изначально была высокая степень тяжести, как правило, проводили в стационаре больше времени по сравнению с теми, у кого была средняя степень тяжести.
    *   Статистический тест (U-критерий Манна-Уитни) должен подтвердить статистическую значимость этого различия.

**5. График "'D-димер' vs Длительность госпитализации"**

*   **Где в скрипте:** Генерируется функцией `analyze_numeric_vs_duration(df_analysis_survived, 'D-dimer', 'D-димер')`.
*   **Тип графика:** Диаграмма рассеяния (Scatter plot).
*   **Что изображено:**
    *   **Ось X (D-димер):** Уровень D-димера у выживших пациентов.
    *   **Ось Y (Длительность госпитализации (дни)):** Длительность пребывания в стационаре.
    *   **Точки:** Каждая точка – выживший пациент. Положение точки определяется уровнем D-димера и длительностью госпитализации.
*   **Цель и интерпретация:**
    *   Визуально оценить, есть ли связь (корреляция) между уровнем D-димера и длительностью госпитализации у выживших пациентов.
    *   **Наблюдение:** На графике видно, что большинство пациентов имеют низкие и умеренные уровни D-димера (например, до 1000-1500) с различной длительностью госпитализации. У пациентов с очень высокими уровнями D-димера (например, >2000-3000) также наблюдается разная длительность госпитализации, и их количество меньше. Четкой линейной зависимости не прослеживается, но возможно, есть некоторая тенденция к более длительной госпитализации при очень высоких значениях D-димера, хотя разброс велик.
    *   Статистический тест (коэффициент корреляции Спирмена) поможет количественно оценить эту связь.

**6. График "'Ферритин' vs Длительность госпитализации"**

*   **Где в скрипте:** Генерируется функцией `analyze_numeric_vs_duration(df_analysis_survived, 'Ferritin', 'Ферритин')`.
*   **Тип графика:** Диаграмма рассеяния (Scatter plot).
*   **Что изображено:**
    *   **Ось X (Ферритин):** Уровень ферритина у выживших пациентов.
    *   **Ось Y (Длительность госпитализации (дни)):** Длительность пребывания в стационаре.
    *   **Точки:** Каждая точка – выживший пациент.
*   **Цель и интерпретация:**
    *   Визуально оценить, есть ли связь (корреляция) между уровнем ферритина и длительностью госпитализации у выживших.
    *   **Наблюдение:** Аналогично D-димеру, большинство пациентов имеют уровни ферритина в нижней и средней части диапазона (например, до 1000-1500) с разной длительностью госпитализации. Пациенты с очень высокими уровнями ферритина встречаются реже. Визуально сильной линейной связи не наблюдается, но возможно, есть слабая тенденция к увеличению длительности госпитализации при более высоких значениях ферритина.
    *   Статистический тест (коэффициент корреляции Спирмена) даст количественную оценку.

##Выводы по работе
В процессе исследования было выяснено, что вакцинация существенно влияет на выживаемость и скорость выписки среди пациентов. Наибольший процент выживаемости у пациентов, которым был введён Спутник Лайт(4.2%), однако с учетом большой выборки для Спутник V, можно считать, что он показал лучший результат. 
Возраст сильно влияет как на риск заболеть, так и на шансы выписки (молодых умерших <50 лет почти нет, а младше 25 были выписаны все). Также, чем старше пациент, тем, зачастую, он дольше находился в стационаре.
Было также замечено, что смертность среди пациентов мужского пола сильно выше, чем у женщин. Показатели отличаются в два раза (среди женщин ~9% умерших, а среди мужчин ~18%). А вот на сроки госпитализации пол почти не влияет.
Тяжесть состояния пациентов напрямую влияет и на смертность и на длительность пребывания в стационаре. Так среди тяжелых пациентов умерших почти 70%, а среди средне-тяжелых около 5.
Показатели D-димера и ферритина, судя по данным, не оказывали существенного влияния на смертность и длительность госпитализации.
